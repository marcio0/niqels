{% extends "base.html" %}

{% block body %}

{% load humanize %}
{% load expenses_tags %}

<div class="container">
    <div class="hero-unit">
        {% include "expenses/forms/entry.html" with form=entry_form %}
    </div>

    <table class="table">
    {% for entry in entries %}
        {% ifchanged entry.date.year entry.date.month %}
            {% if not forloop.first %}
                </tbody>
            {% endif %}
            <thead><tr>
                <th colspan="4">Ano {{ entry.date.year }} | Mes {{ entry.date.month }}</th>
            </tr></thead>
            <tbody>
        {% endifchanged %}
            <tr class="entry-row"
                data-date="{{ entry.date|date:"SHORT_DATE_FORMAT" }}"
                data-category="{{ entry.category }}"
                data-value="{{ entry.value }}"
                data-description="{{ entry.description }}"
                data-id="{{ entry.id }}">

                <td>{{ entry.date|naturalday }}</td>
                <td>{{ entry.category|as_category }}</td>
                <td>$ {{ entry.value }}</td>
                <td>{{ entry.description|truncatechars:50}}</td>
            </tr>
        {% if forloop.last %}
            </tbody>
        {% endif %}
    {% endfor %}
    </table> 

</div> <!-- container -->

<div class="modal hide fade" id="mymodal">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Edit entry</h3>
    </div>
    <div class="modal-body">
        {% include "expenses/forms/entry.html" %}
    </div>
    <div class="modal-footer">
        <a href="#" class="btn">Close</a>
        <a href="#" class="btn btn-primary">Save changes</a>
    </div>
</div>

{% endblock body %}

{% block bodyend %}
    <script type="text/javascript">
    $(function(){
        $('.datepicker').datepicker({
            format: 'mm/dd/yyyy'
        });

        $('#id_value').tooltip();

        $('.entry-row').click(function(){
            $('#mymodal').modal('show');
        });

        //$(".entry-form input,select,textarea").not("[type=submit]").jqBootstrapValidation();
    });
    </script>
{% endblock bodyend %}
